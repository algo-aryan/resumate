<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATS Resume Score</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="ats.css">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="text-center mb-4">ATS Resume Scoring</h2>

    <form id="resume-form" class="card shadow p-4">
      <div class="mb-3">
        <label for="resume" class="form-label">Upload Your Resume (PDF):</label>
        <input class="form-control" type="file" id="resume" name="resume" accept="application/pdf" required>
      </div>
      <button type="submit" class="btn btn-primary">Get ATS Score</button>
    </form>

    <div id="result-container" class="mt-5 d-none">
      <h4 class="mb-3">📊 ATS Score: <span id="score" class="badge bg-success fs-5"></span></h4>
      <p id="summary" class="fst-italic text-muted"></p>

      <div class="mt-4">
        <h5>✅ Strengths</h5>
        <ul id="strengths" class="list-group list-group-flush"></ul>
      </div>

      <div class="mt-4">
        <h5>🛠 Suggestions for Improvement</h5>
        <ul id="suggestions" class="list-group list-group-flush"></ul>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('resume-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const form = e.target;
      const fileInput = form.querySelector('#resume');
      const file = fileInput.files[0];

      const formData = new FormData();
      formData.append('resume', file);

      const resultContainer = document.getElementById('result-container');
      const scoreEl = document.getElementById('score');
      const summaryEl = document.getElementById('summary');
      const strengthsEl = document.getElementById('strengths');
      const suggestionsEl = document.getElementById('suggestions');

      try {
        const res = await fetch('http://resumate-production-a93f.up.railway.app/api/ats-score', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.error) {
          alert('❌ ' + (data.reason || data.error));
          return;
        }

        const { score, summary, raw } = data;
        scoreEl.textContent = score;
        summaryEl.textContent = summary;

        const parsed = JSON.parse(raw.match(/```json\n([\s\S]+?)\n```/)[1]);

        strengthsEl.innerHTML = '';
        parsed.strengths.forEach(strength => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = strength;
          strengthsEl.appendChild(li);
        });

        suggestionsEl.innerHTML = '';
        parsed.suggestions.forEach(suggestion => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = suggestion;
          suggestionsEl.appendChild(li);
        });

        resultContainer.classList.remove('d-none');
      } catch (err) {
        console.error(err);
        alert('Something went wrong while scoring the resume.');
      }
    });
  </script>
</body>
</html>